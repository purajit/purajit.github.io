<head>
  <title>purajit | {{ tab_title }}</title>
  <meta charset="utf-8"/>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico"/>
  <style>
@font-face {
    font-family: 'Libre Caslon Text';
    src: local('Libre Caslon Text Regular'), url(/static/LibreCaslonText-Regular.ttf) format('truetype');
}

:root {
  color-scheme: light dark;
  --btn-bg: light-dark(#e0e0e0, #2a2a2a);
  --btn-hover: light-dark(#cfcfcf, #3a3a3a);
  --radius: 0.5rem;
  --gap: 1rem;
  --background-color: light-dark(#f9f9f9, #121212);
  --font-color: light-dark(#111111, #f5f5f5);
  --tile-background-color: light-dark(rgba(0, 0, 0, 0.02), rgba(255, 255, 255, 0.02));
}

html, body {
  margin: 0;
  padding: 0;
  height: 100vh;
  background: var(--background-color);
  color: var(--font-color);
  font-family: "Libre Caslon Text";
}

.flex-col {
  display: flex;
  flex-direction: column;
}

.flex-row {
  display: flex;
  flex-direction: row;
}

.gappy {
  gap: var(--gap);
}

.hourglass {
  align-items: center;
  width: fit-content;
  padding: 1rem;
  box-sizing: border-box;
  margin: auto;
  height: 100vh;
  justify-content: center;
}

#hourglass-display {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: var(--tile-background-color);
  border-radius: var(--radius);
  padding: 1rem;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  box-sizing: border-box;
}

.timedisplay {
  font-size: 10rem;
  font-weight: bold;
  line-height: 1.1;
  width: 5ch; /* Enough for 9999 */
  text-align: center;
}

.label {
  font-size: 2rem;
  opacity: 0.7;
  margin-bottom: 0.5rem;
}

.btn {
  background: var(--btn-bg);
  padding: 0.5rem 1rem;
  margin: 0.25rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 500;
  transition: background 0.2s;
  user-select: none;
  font-size: 3rem;
}

.btn:hover {
  background: var(--btn-hover);
}

#hourglass-form {
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
  font-size: 2rem;
}

#hourglass-timerequested {
  width: 80px;
  padding: 0.3rem 0.5rem;
  font-size: 1rem;
  border-radius: var(--radius);
  border: 1px solid light-dark(#ccc, #333);
  background: light-dark(#fff, #2a2a2a);
  color: inherit;
}

  </style>
</head>
<body>
  <div id="main">
    <div id="contents">
      <audio id="hourglass-beep" src="{{ static_url }}/sounds/timer-beep.mp3" preload="auto"></audio>
      <audio id="hourglass-end" src="{{ static_url }}/sounds/timer-end.mp3" preload="auto"></audio>
      <div class="hourglass flex-col gappy">
        <div id="hourglass-display" class="flex-col gappy">
          <div class="flex-row">
            <div class="timedisplay" id="hourglass-timeleft"></div>
          </div>
          <div class="flex-row label">
            <div class="flex-col">seconds left</div>
          </div>
          <div class="flex-row">
            <div class="timedisplay" id="hourglass-timeelapsed"></div>
          </div>
          <div class="flex-row label">
            <div class="flex-col">seconds elapsed</div>
          </div>
          <div class="flex-row gappy">
            <div class="btn" id="hg-control">Start</div>
            <div class="btn" id="hg-flip">Flip</div>
          </div>
        </div>
        <form id="hourglass-form" class="gappy">
          <input inputmode="numeric" id="hourglass-timerequested">seconds
        </form>
      </div>
    </div>
  </div>
</body>

<script>
 let totalTime;
 let timeLeft;
 let currentTimer;

 function flip() {
     timeLeft = totalTime - timeLeft;
     document.getElementById("hourglass-timeleft").textContent = timeLeft <= 0 ? '0' : timeLeft;
     document.getElementById("hourglass-timeelapsed").textContent = timeLeft <= 0 ? totalTime : totalTime - timeLeft;
 }

 function reset() {
     document.getElementById("hourglass-timerequested").blur();

     clearInterval(currentTimer);

     totalTime = document.getElementById("hourglass-timerequested").value;
     timeLeft = totalTime;

     document.getElementById("hourglass-timeleft").textContent = totalTime;
     document.getElementById("hourglass-timeelapsed").textContent = 0;

     document.getElementById("hg-control").textContent = "Start";
 }

 function initiateTimer() {
     reset();
     currentTimer = setInterval(function() {
         timeLeft--;
         document.getElementById("hourglass-timeleft").textContent = timeLeft <= 0 ? '0' : timeLeft;
         document.getElementById("hourglass-timeelapsed").textContent = timeLeft <= 0 ? totalTime : totalTime - timeLeft;
         if (timeLeft > 0 && timeLeft <= 5) {
             document.getElementById('hourglass-beep').play();
         }

         if (timeLeft <= 0) {
             document.getElementById("hg-control").textContent = "Start";
             document.getElementById('hourglass-end').play();
             clearInterval(currentTimer);
         }
     }, 1000);

     document.getElementById("hg-control").textContent = "Reset";
 }

 // primary action taken on click/hitting space
 function primaryAction() {
     if (timeLeft <= 0 || !currentTimer) {
         initiateTimer();
     } else {
         flip();
     }
 }

 window.onload = function() {
     window.onkeydown = function(e) {
         if (e.key == " " || e.code == "Space" || e.keyCode == 32) {
             e.preventDefault();
             primaryAction();
         }
     }

     document.getElementById("hg-control").textContent = "Start";
     document.getElementById("hourglass-timerequested").value = 180;
     document.getElementById("hourglass-timeleft").textContent = 180;
     document.getElementById("hourglass-timeelapsed").textContent = 0;

     document.getElementById("hourglass-display").onclick = function(e) {
         e.preventDefault();
         primaryAction();
     }
     document.getElementsByClassName("page-content")[0].ondblclick = function(e) {
         e.preventDefault();
         enterAppMode();
     }
     document.getElementById("hourglass-form").onsubmit = function(e) {
         e.preventDefault();
         initiateTimer();
     };

     document.getElementById("hg-control").onclick = function(e) {
         if (e.target.textContent === "Start") {
             initiateTimer();
         } else {
             reset();
         }
     };

     document.getElementById("hg-flip").onclick = function(e) {
         flip();
     };
 };
</script>
